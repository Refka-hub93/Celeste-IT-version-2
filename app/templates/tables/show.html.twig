{% extends 'base.html.twig' %}


{% block javascripts %}
	<script src="{{ asset('js/table.js') }}" defer></script>
	<script src="{{ asset('js/bootstrapModal.js') }}" defer></script>
	<script src="{{ asset('js/columnsApi.js') }}" defer></script>
	<script src="{{ asset('js/tableApi.js') }}" defer></script>
	<script src="{{ asset('js/cardsApi.js') }}" defer></script>

{% endblock %}

{% block title %}
	{{ tableau.title }}
{% endblock %}


{% block body %}
    <div class="container mt-5">
        <h1 class="display-4 text-center text-primary">
            🗂️ {{ tableau.title }}
        </h1>

        <!-- Lien retour avec un style de bouton Bootstrap -->
        <div class="text-center mt-4">
            <a href="{{ path('app_tables') }}" class="btn btn-secondary">
                ⬅️ Retour à mes tableaux
            </a>
        </div>
    </div>

	
	<main class="board d-flex flex-wrap   gap-3 p-1" id="board" data-table-id="{{ tableau.id }}">
		<div class="text-center mb-4">
			<button id="add-list-button" class="btn btn-primary">Ajouter une liste</button>
			<div class="cards"></div>
		</div>
		<div class="lists-container" id="lists-container">
		
		
		{# #################### #}
		
		
		{# 🔁 BOUCLE SUR LES COLONNES #}
    {% for column in tableau.columns %}
      <div class="list border p-2 rounded shadow" data-column-id="{{ column.id }}">
        <div class="list-header m-1">
          {# titre de la colonne #}
          <input type="text"
                 class="list-title form-control"
                 value="{{ column.columnTitle }}"
                 placeholder="Titre de la liste…">

          <button class="add-card-button btn pe-2 m-3">Ajouter une carte</button>
          <button class="remove-list-button btn btn-danger">Supprimer cette liste</button>
        </div>

        <ul class="cards text-center me-4 pe-2">
          {# 🔁 BOUCLE SUR LES CARTES DE LA COLONNE #}
		 
			
		  
          {% for card in column.cards %}
            <li class="card" draggable="true" data-card-id="{{ card.id }}">
		 
              <div class="card-body">
                <h5 class="card-title btn"
                    data-bs-toggle="modal"
                    data-bs-target="#cardModal"
                    data-bs-title="{{ card.cardTitle }}"
                    data-bs-description="{{ card.description }}"
                    data-bs-comments="">
                  {{ card.cardTitle }}
                </h5>

                <button class="remove-card-button">🗑 Supprimer</button>
              </div>
            </li>
          {% endfor %}
        </ul>
      </div>
    {% endfor %}
  
		
		
		
		
		
		
		</div>
	</main>

	<template id="list-template">
		<section class="list border p-2 rounded shadow  "  data-column-id="">
			<div class="list-header m-1">
				<input type="text" class="list-title form-control" placeholder="Titre de la liste">
				<button class="add-card-button btn pe-2 m-3">
					Ajouter une carte
				</button>

				<button class="remove-list-button btn btn-danger">Supprimer cette liste</button>
				<!-- Bouton pour supprimer la colonne -->
			</div>
			<ul class="cards text-center me-4 pe-2"></ul>
		</section>
	</template>



	<template id="card-template">
		<li class="card" draggable="true" data-card-id="">
			<div class="card-body">
				<h5 class="card-title btn">Titre</h5>
				<button class="remove-card-button">🗑 Supprimer</button>
			</div>
		</li>
	</template>


	<!-- Modal Bootstrap -->
	<div class="modal fade" id="cardModal" tabindex="-1" aria-labelledby="cardModalLabel" aria-hidden="true">
		<div class="modal-dialog modal-lg">
			<div class="modal-content p-3">

				<div class="modal-header">
					<h5 class="modal-title fw-bold" id="cardModalLabel">Créer une carte</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fermer"></button>
				</div>

				<div class="modal-body">
					<form id="card-details-form">

						<div class="mb-4 w-100">
							<label for="card-title" class="form-label fw-semibold">Titre de la carte</label>
							<input type="text" id="card-title" class="form-control form-control-lg w-100" placeholder="Titre de la carte">
						</div>

						<div class="mb-4 w-100">
							<label for="card-description" class="form-label fw-semibold">Description</label>
							<textarea id="card-description" class="form-control form-control-lg w-100" rows="4" placeholder="Ajoutez une description"></textarea>
						</div>

						<div class="mb-4 w-100">
							<label for="card-comments" class="form-label fw-semibold">Commentaires</label>
							<textarea id="card-comments" class="form-control form-control-lg w-100" rows="4" placeholder="Ajoutez des commentaires"></textarea>
						</div>

						<div class="d-grid">
							<button type="submit" class="btn btn-primary">Enregistrer</button>
						</div>

					</form>
				</div>

				<div class="modal-footer">
					<button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Fermer</button>
				</div>

			</div>
		</div>
	</div>


{% endblock %}